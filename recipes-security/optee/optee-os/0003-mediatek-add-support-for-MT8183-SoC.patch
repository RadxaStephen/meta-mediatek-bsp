From 1c596114a56118a8d7eb0329031d5c5d7942fc9f Mon Sep 17 00:00:00 2001
From: Fabien Parent <fparent@baylibre.com>
Date: Fri, 5 Jul 2019 10:56:42 +0200
Subject: [PATCH 3/3] mediatek: add support for MT8183 SoC

Signed-off-by: Fabien Parent <fparent@baylibre.com>
---
 core/arch/arm/plat-mediatek/conf.mk           | 19 ++++++++++++++++---
 core/arch/arm/plat-mediatek/platform_config.h | 14 ++++++++++++++
 2 files changed, 30 insertions(+), 3 deletions(-)

diff --git a/core/arch/arm/plat-mediatek/conf.mk b/core/arch/arm/plat-mediatek/conf.mk
index 3a3d8fb9ef5d..4c09977dcce0 100644
--- a/core/arch/arm/plat-mediatek/conf.mk
+++ b/core/arch/arm/plat-mediatek/conf.mk
@@ -2,8 +2,6 @@ PLATFORM_FLAVOR ?= mt8173
 
 include core/arch/arm/cpu/cortex-armv8-0.mk
 
-$(call force,CFG_TEE_CORE_NB_CORE,4)
-
 $(call force,CFG_8250_UART,y)
 $(call force,CFG_GENERIC_BOOT,y)
 $(call force,CFG_PM_STUBS,y)
@@ -20,13 +18,28 @@ CFG_WITH_STACK_CANARIES ?= y
 
 ifeq ($(PLATFORM_FLAVOR),mt8173)
 # 2**1 = 2 cores per cluster
+$(call force,CFG_TEE_CORE_NB_CORE,4)
 $(call force,CFG_CORE_CLUSTER_SHIFT,1)
 CFG_TZDRAM_START ?= 0xbe000000
 CFG_TZDRAM_SIZE ?= 0x01e00000
 CFG_SHMEM_START ?= 0xbfe00000
 CFG_SHMEM_SIZE ?= 0x00200000
-else ($(PLATFORM_FLAVOR),mt8516)
+endif
+
+ifeq ($(PLATFORM_FLAVOR),mt8516)
+$(call force,CFG_TEE_CORE_NB_CORE,4)
+$(call force,CFG_CORE_CLUSTER_SHIFT,2)
+CFG_TZDRAM_START ?= 0x4fd00000
+CFG_TZDRAM_SIZE ?=  0x00300000
+CFG_SHMEM_START ?= 0x5fd00000
+CFG_SHMEM_SIZE ?= 0x00200000
+endif
+
+ifeq ($(PLATFORM_FLAVOR),mt8183)
+$(call force,CFG_TEE_CORE_NB_CORE,8)
 $(call force,CFG_CORE_CLUSTER_SHIFT,2)
+$(call force,CFG_ARM_GICV3,y)
+$(call force,CFG_GIC,y)
 CFG_TZDRAM_START ?= 0x4fd00000
 CFG_TZDRAM_SIZE ?=  0x00300000
 CFG_SHMEM_START ?= 0x5fd00000
diff --git a/core/arch/arm/plat-mediatek/platform_config.h b/core/arch/arm/plat-mediatek/platform_config.h
index b8525b21dd43..25d36d8f0d2d 100644
--- a/core/arch/arm/plat-mediatek/platform_config.h
+++ b/core/arch/arm/plat-mediatek/platform_config.h
@@ -49,6 +49,20 @@
 #define CONSOLE_BAUDRATE	921600
 #define CONSOLE_UART_CLK_IN_HZ	26000000
 
+#elif defined(PLATFORM_FLAVOR_mt8183)
+
+#define GIC_BASE		0x0C000000
+#define GICC_OFFSET		0x400000
+#define GICD_OFFSET		0x00000
+
+#define UART0_BASE		0x11002000
+#define UART1_BASE		0x11103000
+#define UART2_BASE		0x11104000
+
+#define CONSOLE_UART_BASE	UART0_BASE
+#define CONSOLE_BAUDRATE	921600
+#define CONSOLE_UART_CLK_IN_HZ	26000000
+
 #else
 #error "Unknown platform flavor"
 #endif
-- 
2.25.0

